---
name: utility-layered-explainer
description: 同じトピックを「浅い→深い→第一原理」まで一度に段階的に解説する（TL;DR/概要/仕組み/第一原理=Whyの連鎖）。追加の「Why」を何度も要求させず、最初から理解の階段を用意したいときに使う。Use when user asks for deep/first-principles explanations or complains answers are too shallow.
metadata:
  short-description: Layered explanation helper
---

# Layered Explainer Skill

ユーザーの質問に対して、**同じ回答内で**「概要→仕組み→第一原理」までの深さをそろえて出す。

## 入力（あるだけでOK）

- 質問文（何を・なぜ・どうしたいか）
- 具体例（コード/ログ/エラー文/図）
- 制約（時間、変更できない前提、環境）

## Workflow

### 0) まずゴールを1行で固定する

- 例: 「原因を理解して直したい」「設計判断の是非を知りたい」「仕組みを腹落ちさせたい」
- 不明でも止めず、**推測で置いて進める**（最後に確認質問を最大2つだけ添える）

### 1) 解説は必ず “4レイヤー + 実務” で出す（固定）

#### L0: TL;DR（30秒）

- 結論を1〜3文で言い切る（原因→結果→対処の順が無難）

#### L1: ざっくり（2分）

- 専門用語を最小限にして「何が起きているか」を説明
- 用語が必要なら1行定義を添える（このレイヤーで長い説明はしない）

#### L2: 仕組み（5分）

- 「どの条件で起きるか」を手順/フローで説明（箇条書き or 番号付き）
- 可能なら **ユーザーの具体例** に一度マッピングする（例: “このヘッダーが付く→プリフライト→ブロック”）

#### L3: 第一原理（深掘り / Why の連鎖）

- “なぜそう設計されているか” を掘る（セキュリティ、整合性、性能、運用、コスト）
- 3段くらいの Why を目安に、**境界条件/不可能性** まで落とす
- 「無視ではなくブロック」などの “直感に反する挙動” は、このレイヤーで必ず扱う

#### 実務への落とし込み（次の一手）

- 直すなら何を変えるか（1〜3個）
- 確かめるならどこを見るか（ログ/設定/再現手順/観測点）
- 代替案があるならトレードオフを1行ずつ

### 2) 追加質問は “深掘りの選択肢” にする（最大2つ）

- 説明の後ろに、追加で答えやすい質問を添える
- 例: 「この話は “ブラウザ” のCORS前提でOK？（サーバー間通信なら別）」

## 出力テンプレ（この形を崩しすぎない）

```markdown
## TL;DR（30秒）
...

## ざっくり（2分）
...

## 仕組み（5分）
...

## 第一原理（Why の連鎖）
...

## 実務：次に何をする？
- ...

## 確認（任意）
- ...
```

## ミニ例（CORS + カスタムヘッダー）

- **L0:** クロスオリジンにカスタムヘッダーを付けるとプリフライトが走り、許可リストに無いと**ブラウザが本リクエストを送らずに止める**。
- **L2:** `Access-Control-Request-Headers` → `Access-Control-Allow-Headers` を照合し、不一致ならブロック。
- **L3:** もし「無視」できると、攻撃者が任意ヘッダー（認可/識別子等）を付けて境界を越えられ、同一オリジンの前提（=権限分離）が崩れるため “ホワイトリスト” が必要。
